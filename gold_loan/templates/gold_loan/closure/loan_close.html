{% extends "gold_loan/base.html" %}
{% load static %}

{% block title %}Close Loan - {{ loan.loan_number }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'gold_loan/css/loan_close.css' %}">
{% endblock %}

{% block content %}
<div class="close-container">
    <div class="close-header">
        <h2 style="margin: 0; color: #111;">Close Loan</h2>
        <div style="color: #666; margin-top: 5px;">{{ loan.loan_number }}</div>
    </div>

    <div class="balance-row">
        <span>Principal Outstanding</span>
        <span>₹{{ outstanding_principal|floatformat:2 }}</span>
    </div>
    <div class="balance-row">
        <span>Pending Interest</span>
        <span>₹{{ pending_interest }}</span>
    </div>

    <div class="total-row">
        <span>Total Due</span>
        <span>₹{{ total_due|floatformat:2 }}</span>
    </div>

    {% if can_close %}
    <div class="success-box" style="margin-top: 20px;">
        This loan is fully paid and eligible for closure.
    </div>

    <form method="POST">
        {% csrf_token %}
        <button type="submit" class="btn-close"
            onclick="return confirm('Are you sure you want to permanently close this loan? This action cannot be undone.')">
            Confirm & Close Loan
        </button>
    </form>
    {% else %}
    <div class="warning-box" style="margin-top: 20px;">
        Loan cannot be closed. Outstanding amount exists.
    </div>

    <a href="{% url 'gold_loan:loan_payment_view' loan.id %}" class="btn-pay">
        Go to Payment Page
    </a>
    {% endif %}

    <a href="{% url 'gold_loan:loan_view' loan.id %}" class="btn-cancel">Cancel</a>
</div>
{% endblock %}