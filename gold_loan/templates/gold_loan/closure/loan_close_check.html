{% extends "gold_loan/base.html" %}
{% load static %}

{% block title %}Close Loan - {{ loan.loan_number }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'gold_loan/css/loan_close.css' %}">
{% endblock %}

{% block content %}
<div class="close-container">
    <div class="close-header">
        <h2 style="margin: 0; color: #111;">Close Loan</h2>
        <div style="color: #666; margin-top: 5px;">{{ loan.loan_number }}</div>
    </div>

    <div class="balance-row">
        <span>Principal Outstanding</span>
        <span>₹{{ outstanding_principal|floatformat:2 }}</span>
    </div>
    <div class="balance-row">
        <span>Pending Interest</span>
        <span>₹{{ pending_interest }}</span>
    </div>

    <div class="total-row">
        <span>Total Due</span>
        <span>₹{{ total_due|floatformat:2 }}</span>
    </div>

    {% if can_close %}
    <div class="success-box" style="margin-top: 20px;">
        This loan is fully paid and eligible for closure.
    </div>

    <div style="margin-top: 24px; display: flex; flex-direction: column; gap: 4px;">
        <a href="{% url 'gold_loan:loan_close_otp' loan.id %}" class="btn-close">
            Confirm & Close Loan
        </a>

        <form action="{% url 'gold_loan:loan_extend_action' loan.id %}" method="get" style="width: 100%;">
            <input type="hidden" name="from_closure" value="true">
            <button type="submit" class="btn-extend">
                Close & Extend Loan
            </button>
        </form>
    </div>
    {% else %}
    <div class="warning-box" style="margin-top: 20px;">
        Outstanding amount exists. Please complete payment before closing.
    </div>

    <a href="{% url 'gold_loan:loan_payment_view' loan.id %}" class="btn-pay">
        Go to Payment Page
    </a>
    {% endif %}

    <a href="{% url 'gold_loan:loan_view' loan.id %}" class="btn-cancel">Cancel</a>
</div>
{% endblock %}