{% extends "gold_loan/base.html" %}
{% load static %}

{% block title %}Loan Entry â€“ OTP Verification{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'gold_loan/css/loan_entry.css' %}">
{% endblock %}

{% block page_header %}
<h3>OTP Verification</h3>
{% endblock %}

{% block content %}
<form method="post" class="loan-form otp-box" id="otpForm">
    {% csrf_token %}

    <p>Enter OTP sent to admin and customer</p>

    {% if error %}
        <p style="color:red; font-weight:600;">{{ error }}</p>
    {% endif %}

    <input
        type="text"
        name="otp"
        id="otpInput"
        maxlength="6"
        placeholder="Enter 6-digit OTP"
        required
    >

    <div class="actions">
        <button type="submit" class="btn-primary">
            Verify & Save
        </button>

        <button type="button" class="btn-secondary" id="resendOtp">
            Resend OTP
        </button>
    </div>
</form>

<script>
/*
 TEMP OTP LOGIC (as requested)
 --------------------------------
 Valid OTP = 123456
 Checked in JS first
 Backend also checks same value
*/

document.getElementById("otpForm").addEventListener("submit", function (e) {
    const otp = document.getElementById("otpInput").value;

    console.log("Entered OTP:", otp);

    if (otp.length !== 6 || !/^\d+$/.test(otp)) {
        e.preventDefault();
        alert("OTP must be exactly 6 digits");
        return;
    }

    if (otp !== "123456") {
        e.preventDefault();
        alert("Invalid OTP (use 123456 for now)");
        return;
    }

    console.log("OTP verified successfully");
    // form submits to Django backend
});

document.getElementById("resendOtp").addEventListener("click", function () {
    console.log("OTP resent to admin & customer (mock)");
    alert("OTP resent successfully (check console)");
});
</script>
{% endblock %}
